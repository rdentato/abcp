/* 
**  (C) by Remo Dentato (rdentato@gmail.com)
** 
** This software is distributed under the terms of the BSD license:
**   http://creativecommons.org/licenses/BSD/
**   http://opensource.org/licenses/bsd-license.php 
*/

#include <ctype.h>
#include "abcp_priv.h"



#define getfraction(s,n) abc_getfracion(abcTokenStart(s,n),   \
                                        abcTokenLen(s,n),     \
                                        abcTokenStart(s,n+1), \
                                        abcTokenLen(s,n+1),   \
                                        abcTokenStart(s,n+2), \
                                        abcTokenLen(s,n+2)) 

#define EXTR1(a,b,c) a
#define EXTR2(a,b,c) b
#define EXTR3(a,b,c) c

static char *sagittal[] = {
EXTR1("!"          ,  0.0       ,  0x32 ) ,      
EXTR1("!!!("       ,  -119.4428 ,  0x5A ) ,      
EXTR1("!!!)"       ,  -140.9491 ,  0x50 ) ,      
EXTR1("!!!/"       ,  -145.4517 ,  0x4E ) ,      
EXTR1("!!!/)"      ,  -172.8418 ,  0x41 ) ,      
EXTR1("!!!//"      ,  -177.4751 ,  0x3F ) ,      
EXTR1("!!!~"       ,  -130.2293 ,  0x55 ) ,      
EXTR1("!!)"        ,  -86.4209  ,  0x68 ) ,      
EXTR1("!!/"        ,  -92.1787  ,  0x66 ) ,      
EXTR1("!!~"        ,  -75.6344  ,  0x6D ) ,      
EXTR1("!("         ,  -5.7578   ,  0x8E ) ,      
EXTR1("!)"         ,  -27.2641  ,  0x84 ) ,      
EXTR1("!/"         ,  -31.7667  ,  0x82 ) ,      
EXTR1("!/)"        ,  -59.1568  ,  0x75 ) ,      
EXTR1("!//"        ,  -63.7901  ,  0x73 ) ,      
EXTR1("!~"         ,  -16.5443  ,  0x89 ) ,      
EXTR1("("          ,  207.2880  ,  0xEF ) ,      
EXTR1("(!"         ,  -33.1480  ,  0x81 ) ,      
EXTR1("(!!"        ,  -93.6030  ,  0x65 ) ,      
EXTR1("(!!!"       ,  -146.8330 ,  0x4D ) ,      
EXTR1("(!!!("      ,  -152.5908 ,  0x4A ) ,      
EXTR1("(!!!)"      ,  -174.0971 ,  0x40 ) ,      
EXTR1("(!!!/"      ,  -178.5996 ,  0x3E ) ,      
EXTR1("(!!!~"      ,  -163.5799 ,  0x45 ) ,      
EXTR1("(!!("       ,  -98.9546  ,  0x62 ) ,      
EXTR1("(!!~"       ,  -110.3070 ,  0x5D ) ,      
EXTR1("(!("        ,  -38.9058  ,  0x7E ) ,      
EXTR1("(!)"        ,  -60.4121  ,  0x74 ) ,      
EXTR1("(!/"        ,  -64.9146  ,  0x72 ) ,      
EXTR1("(!~"        ,  -49.8949  ,  0x79 ) ,      
EXTR1("(/|"        ,  54.5282   ,  0xA9 ) ,      
EXTR1("(/|||"      ,  168.2132  ,  0xDD ) ,      
EXTR1("(X("        ,  212.6396  ,  0xF2 ) ,      
EXTR1("(X~"        ,  223.9920  ,  0xF7 ) ,      
EXTR1("(Y"         ,  -207.2880 ,  0x31 ) ,      
EXTR1("(Y("        ,  -212.6396 ,  0x2E ) ,      
EXTR1("(Y~"        ,  -223.9920 ,  0x29 ) ,      
EXTR1("(\\!"       ,  -54.5282  ,  0x77 ) ,      
EXTR1("(\\!!!"     ,  -168.2132 ,  0x43 ) ,      
EXTR1("(|"         ,  33.1480   ,  0x9F ) ,      
EXTR1("(|("        ,  38.9058   ,  0xA2 ) ,      
EXTR1("(|)"        ,  60.4121   ,  0xAC ) ,      
EXTR1("(|\\"       ,  64.9146   ,  0xAE ) ,      
EXTR1("(||"        ,  93.6030   ,  0xBB ) ,      
EXTR1("(||("       ,  98.9546   ,  0xBE ) ,      
EXTR1("(|||"       ,  146.8330  ,  0xD3 ) ,      
EXTR1("(|||("      ,  152.5908  ,  0xD6 ) ,      
EXTR1("(|||)"      ,  174.0971  ,  0xE0 ) ,      
EXTR1("(|||\\"     ,  178.5996  ,  0xE2 ) ,      
EXTR1("(|||~"      ,  163.5799  ,  0xDB ) ,      
EXTR1("(||~"       ,  110.3070  ,  0xC3 ) ,      
EXTR1("(|~"        ,  49.8949   ,  0xA7 ) ,      
EXTR1(")!"         ,  -3.3780   ,  0x8F ) ,      
EXTR1(")!!!"       ,  -117.0630 ,  0x5B ) ,      
EXTR1(")!!!("      ,  -123.3730 ,  0x58 ) ,      
EXTR1(")!!!)"      ,  -144.3271 ,  0x4F ) ,      
EXTR1(")!!!//"     ,  -180.9761 ,  0x3D ) ,      
EXTR1(")!!!~"      ,  -133.7670 ,  0x53 ) ,      
EXTR1(")!!("       ,  -70.6724  ,  0x70 ) ,      
EXTR1(")!!)"       ,  -88.8007  ,  0x67 ) ,      
EXTR1(")!!~"       ,  -80.5370  ,  0x6B ) ,      
EXTR1(")!("        ,  -9.6880   ,  0x8C ) ,      
EXTR1(")!)"        ,  -30.6421  ,  0x83 ) ,      
EXTR1(")!//"       ,  -67.2911  ,  0x71 ) ,      
EXTR1(")!~"        ,  -20.0820  ,  0x87 ) ,      
EXTR1(")/"         ,  196.7279  ,  0xEB ) ,      
EXTR1(")//"        ,  218.6404  ,  0xF5 ) ,      
EXTR1(")//|"       ,  46.3939   ,  0xA5 ) ,      
EXTR1(")//||"      ,  104.9554  ,  0xC1 ) ,      
EXTR1(")//|||"     ,  160.0790  ,  0xD9 ) ,      
EXTR1(")/|"        ,  24.8843   ,  0x9B ) ,      
EXTR1(")/|\\"      ,  56.4819   ,  0xAA ) ,      
EXTR1(")/||"       ,  83.0429   ,  0xB7 ) ,      
EXTR1(")/|||"      ,  138.5693  ,  0xCF ) ,      
EXTR1(")/|||\\"    ,  170.1669  ,  0xDE ) ,      
EXTR1(")X("        ,  184.3574  ,  0xE4 ) ,      
EXTR1(")X)"        ,  202.4857  ,  0xED ) ,      
EXTR1(")X~"        ,  194.2220  ,  0xE9 ) ,      
EXTR1(")Y("        ,  -184.3574 ,  0x3C ) ,      
EXTR1(")Y)"        ,  -202.4857 ,  0x33 ) ,      
EXTR1(")Y~"        ,  -194.2220 ,  0x37 ) ,      
EXTR1(")\\!"       ,  -24.8843  ,  0x85 ) ,      
EXTR1(")\\!!"      ,  -83.0429  ,  0x69 ) ,      
EXTR1(")\\!!!"     ,  -138.5693 ,  0x51 ) ,      
EXTR1(")\\!!!/"    ,  -170.1669 ,  0x42 ) ,      
EXTR1(")\\!/"      ,  -56.4819  ,  0x76 ) ,      
EXTR1(")\\Y"       ,  -196.7279 ,  0x35 ) ,      
EXTR1(")\\\\!"     ,  -46.3939  ,  0x7B ) ,      
EXTR1(")\\\\!!"    ,  -104.9554 ,  0x5F ) ,      
EXTR1(")\\\\!!!"   ,  -160.0790 ,  0x47 ) ,      
EXTR1(")\\\\Y"     ,  -218.6404 ,  0x2B ) ,      
EXTR1(")|"         ,  3.3780    ,  0x91 ) ,      
EXTR1(")|("        ,  9.6880    ,  0x94 ) ,      
EXTR1(")|)"        ,  30.6421   ,  0x9D ) ,      
EXTR1(")|\\\\"     ,  67.2911   ,  0xAF ) ,      
EXTR1(")||("       ,  70.6724   ,  0xB0 ) ,      
EXTR1(")||)"       ,  88.8007   ,  0xB9 ) ,      
EXTR1(")|||"       ,  117.0630  ,  0xC5 ) ,      
EXTR1(")|||("      ,  123.3730  ,  0xC8 ) ,      
EXTR1(")|||)"      ,  144.3271  ,  0xD1 ) ,      
EXTR1(")|||\\\\"   ,  180.9761  ,  0xE3 ) ,      
EXTR1(")|||~"      ,  133.7670  ,  0xCD ) ,      
EXTR1(")||~"       ,  80.5370   ,  0xB5 ) ,      
EXTR1(")|~"        ,  20.0820   ,  0x99 ) ,      
EXTR1(")~"         ,  187.0399  ,  0xE5 ) ,      
EXTR1(")~!"        ,  -12.0644  ,  0x8B ) ,      
EXTR1(")~!!"       ,  -73.3549  ,  0x6F ) ,      
EXTR1(")~!!!"      ,  -125.7494 ,  0x57 ) ,      
EXTR1(")~Y"        ,  -187.0399 ,  0x3B ) ,      
EXTR1(")~|"        ,  12.0644   ,  0x95 ) ,      
EXTR1(")~||"       ,  73.3549   ,  0xB1 ) ,      
EXTR1(")~|||"      ,  125.7494  ,  0xC9 ) ,      
EXTR1("*"          ,  -27.2641  ,  0x84 ) ,
EXTR1("+"          ,  21.5063   ,  0x9A ) ,
EXTR1("-"          ,  -21.5063  ,  0x86 ) ,
EXTR1("/"          ,  195.6034  ,  0xEA ) ,      
EXTR1("//"         ,  217.6821  ,  0xF4 ) ,      
EXTR1("//|"        ,  43.0126   ,  0xA4 ) ,      
EXTR1("//||"       ,  103.9970  ,  0xC0 ) ,      
EXTR1("//|||"      ,  156.6976  ,  0xD8 ) ,      
EXTR1("/X)"        ,  221.6122  ,  0xF6 ) ,      
EXTR1("/X\\"       ,  227.3700  ,  0xF8 ) ,      
EXTR1("/X~"        ,  210.8257  ,  0xF1 ) ,      
EXTR1("/|"         ,  21.5063   ,  0x9A ) ,      
EXTR1("/|)"        ,  48.7704   ,  0xA6 ) ,      
EXTR1("/|\\"       ,  53.2729   ,  0xA8 ) ,      
EXTR1("/||"        ,  81.9184   ,  0xB6 ) ,      
EXTR1("/||)"       ,  107.9272  ,  0xC2 ) ,      
EXTR1("/||\\"      ,  113.6850  ,  0xC4 ) ,      
EXTR1("/|||"       ,  135.1913  ,  0xCE ) ,      
EXTR1("/|||)"      ,  162.4554  ,  0xDA ) ,      
EXTR1("/|||\\"     ,  166.9579  ,  0xDC ) ,      
EXTR1("/|||~"      ,  151.7356  ,  0xD5 ) ,      
EXTR1("/||~"       ,  97.1407   ,  0xBD ) ,      
EXTR1("/|~"        ,  38.0506   ,  0xA1 ) ,      
EXTR1("<"          ,  -53.2729  ,  0x78 ) ,
EXTR1(">"          ,  53.2729   ,  0xA8 ) ,
EXTR1("@"          ,  27.2641   ,  0x9C ) ,
EXTR1("X)"         ,  200.1059  ,  0xEC ) ,      
EXTR1("X\\"        ,  205.8637  ,  0xEE ) ,      
EXTR1("X~"         ,  189.3194  ,  0xE7 ) ,      
EXTR1("Y)"         ,  -200.1059 ,  0x34 ) ,      
EXTR1("Y/"         ,  -205.8637 ,  0x32 ) ,      
EXTR1("Y~"         ,  -189.3194 ,  0x39 ) ,      
EXTR1("["          ,  -93.6030  ,  0x65 ) ,
EXTR1("\\!"        ,  -21.5063  ,  0x86 ) ,      
EXTR1("\\!!"       ,  -81.9184  ,  0x6A ) ,      
EXTR1("\\!!!"      ,  -135.1913 ,  0x52 ) ,      
EXTR1("\\!!!)"     ,  -162.4554 ,  0x46 ) ,      
EXTR1("\\!!!/"     ,  -166.9579 ,  0x44 ) ,      
EXTR1("\\!!!~"     ,  -151.7356 ,  0x4B ) ,      
EXTR1("\\!!)"      ,  -107.9272 ,  0x5E ) ,      
EXTR1("\\!!/"      ,  -113.6850 ,  0x5C ) ,      
EXTR1("\\!!~"      ,  -97.1407  ,  0x63 ) ,      
EXTR1("\\!)"       ,  -48.7704  ,  0x7A ) ,      
EXTR1("\\!/"       ,  -53.2729  ,  0x78 ) ,      
EXTR1("\\!~"       ,  -38.0506  ,  0x7F ) ,      
EXTR1("\\Y"        ,  -195.6034 ,  0x36 ) ,      
EXTR1("\\Y)"       ,  -221.6122 ,  0x2A ) ,      
EXTR1("\\Y/"       ,  -227.3700 ,  0x28 ) ,      
EXTR1("\\Y~"       ,  -210.8257 ,  0x2F ) ,      
EXTR1("\\\\!"      ,  -43.0126  ,  0x7C ) ,      
EXTR1("\\\\!!"     ,  -103.9970 ,  0x60 ) ,      
EXTR1("\\\\!!!"    ,  -156.6976 ,  0x48 ) ,      
EXTR1("\\\\Y"      ,  -217.6821 ,  0x2C ) ,      
EXTR1("]"          ,  93.6030   ,  0xBB ) ,
EXTR1("^"          ,  113.6850  ,  0xFD ) ,      
EXTR1("^^"         ,  227.3700  ,  0xFF ) ,      
EXTR1("_"          ,  -113.6850 ,  0x23 ) ,      
EXTR1("__"         ,  -227.3700 ,  0x21 ) ,      
EXTR1("m"          ,  65.3373   ,  0x12 ) ,
EXTR1("n"          ,  104.9554  ,  0xC1 ) ,
EXTR1("v"          ,  -104.9554 ,  0x5F ) ,
EXTR1("w"          ,  -65.3373  ,  0x10 ) ,
EXTR1("{"          ,  -73.6807  ,  0x11 ) ,
EXTR1("|"          ,  0.0       ,  0x32 ) ,      
EXTR1("|("         ,  5.7578    ,  0x92 ) ,      
EXTR1("|)"         ,  27.2641   ,  0x9C ) ,      
EXTR1("|//|"       ,  0.0000    ,  0x90 ) ,      
EXTR1("|\\"        ,  31.7667   ,  0x9E ) ,      
EXTR1("|\\)"       ,  59.1568   ,  0xAB ) ,      
EXTR1("|\\\\"      ,  63.7901   ,  0xAD ) ,      
EXTR1("||)"        ,  86.4209   ,  0xB8 ) ,      
EXTR1("||\\"       ,  92.1787   ,  0xBA ) ,      
EXTR1("|||("       ,  119.4428  ,  0xC6 ) ,      
EXTR1("|||)"       ,  140.9491  ,  0xD0 ) ,      
EXTR1("|||\\"      ,  145.4517  ,  0xD2 ) ,      
EXTR1("|||\\)"     ,  172.8418  ,  0xDF ) ,      
EXTR1("|||\\\\"    ,  177.4751  ,  0xE1 ) ,      
EXTR1("|||~"       ,  130.2293  ,  0xCB ) ,      
EXTR1("||~"        ,  75.6344   ,  0xB3 ) ,      
EXTR1("|~"         ,  16.5443   ,  0x97 ) ,      
EXTR1("}"          ,  73.6807   ,  0x13 ) ,
EXTR1("~!"         ,  -8.7296   ,  0x8D ) ,      
EXTR1("~!!!"       ,  -122.4146 ,  0x59 ) ,      
EXTR1("~!!!("      ,  -128.4154 ,  0x56 ) ,      
EXTR1("~!!!)"      ,  -149.3818 ,  0x4C ) ,      
EXTR1("~!!!/"      ,  -154.0151 ,  0x49 ) ,      
EXTR1("~!!("       ,  -74.7792  ,  0x6E ) ,      
EXTR1("~!!)"       ,  -96.1089  ,  0x64 ) ,      
EXTR1("~!!/"       ,  -101.6206 ,  0x61 ) ,      
EXTR1("~!("        ,  -14.7304  ,  0x8A ) ,      
EXTR1("~!)"        ,  -35.6968  ,  0x80 ) ,      
EXTR1("~!/"        ,  -40.3301  ,  0x7D ) ,      
EXTR1("~X("        ,  188.4642  ,  0xE6 ) ,      
EXTR1("~X)"        ,  209.7939  ,  0xF0 ) ,      
EXTR1("~X\\"       ,  215.3056  ,  0xF3 ) ,      
EXTR1("~Y("        ,  -188.4642 ,  0x3A ) ,      
EXTR1("~Y)"        ,  -209.7939 ,  0x30 ) ,      
EXTR1("~|"         ,  8.7296    ,  0x93 ) ,      
EXTR1("~|("        ,  14.7304   ,  0x96 ) ,      
EXTR1("~|)"        ,  35.6968   ,  0xA0 ) ,      
EXTR1("~|/"        ,  -215.3056 ,  0x2D ) ,      
EXTR1("~|\\"       ,  40.3301   ,  0xA3 ) ,      
EXTR1("~||("       ,  74.7792   ,  0xB2 ) ,      
EXTR1("~||)"       ,  96.1089   ,  0xBC ) ,      
EXTR1("~||\\"      ,  101.6206  ,  0xBF ) ,      
EXTR1("~|||"       ,  122.4146  ,  0xC7 ) ,      
EXTR1("~|||("      ,  128.4154  ,  0xCA ) ,      
EXTR1("~|||)"      ,  149.3818  ,  0xD4 ) ,      
EXTR1("~|||\\"     ,  154.0151  ,  0xD7 ) ,      
EXTR1("~~"         ,  191.6732  ,  0xE8 ) ,      
EXTR1("~~!"        ,  -17.5761  ,  0x88 ) ,      
EXTR1("~~!!"       ,  -77.9882  ,  0x6C ) ,      
EXTR1("~~!!!"      ,  -131.2611 ,  0x54 ) ,      
EXTR1("~~Y"        ,  -191.6732 ,  0x38 ) ,      
EXTR1("~~|"        ,  17.5761   ,  0x98 ) ,      
EXTR1("~~||"       ,  77.9882   ,  0xB4 ) ,      
EXTR1("~~|||"      ,  131.2611  ,  0xCC ) ,

};

static float sagittalbend[] = {
EXTR2("!"          ,  0.0       ,  0x32 ) ,      
EXTR2("!!!("       ,  -119.4428 ,  0x5A ) ,      
EXTR2("!!!)"       ,  -140.9491 ,  0x50 ) ,      
EXTR2("!!!/"       ,  -145.4517 ,  0x4E ) ,      
EXTR2("!!!/)"      ,  -172.8418 ,  0x41 ) ,      
EXTR2("!!!//"      ,  -177.4751 ,  0x3F ) ,      
EXTR2("!!!~"       ,  -130.2293 ,  0x55 ) ,      
EXTR2("!!)"        ,  -86.4209  ,  0x68 ) ,      
EXTR2("!!/"        ,  -92.1787  ,  0x66 ) ,      
EXTR2("!!~"        ,  -75.6344  ,  0x6D ) ,      
EXTR2("!("         ,  -5.7578   ,  0x8E ) ,      
EXTR2("!)"         ,  -27.2641  ,  0x84 ) ,      
EXTR2("!/"         ,  -31.7667  ,  0x82 ) ,      
EXTR2("!/)"        ,  -59.1568  ,  0x75 ) ,      
EXTR2("!//"        ,  -63.7901  ,  0x73 ) ,      
EXTR2("!~"         ,  -16.5443  ,  0x89 ) ,      
EXTR2("("          ,  207.2880  ,  0xEF ) ,      
EXTR2("(!"         ,  -33.1480  ,  0x81 ) ,      
EXTR2("(!!"        ,  -93.6030  ,  0x65 ) ,      
EXTR2("(!!!"       ,  -146.8330 ,  0x4D ) ,      
EXTR2("(!!!("      ,  -152.5908 ,  0x4A ) ,      
EXTR2("(!!!)"      ,  -174.0971 ,  0x40 ) ,      
EXTR2("(!!!/"      ,  -178.5996 ,  0x3E ) ,      
EXTR2("(!!!~"      ,  -163.5799 ,  0x45 ) ,      
EXTR2("(!!("       ,  -98.9546  ,  0x62 ) ,      
EXTR2("(!!~"       ,  -110.3070 ,  0x5D ) ,      
EXTR2("(!("        ,  -38.9058  ,  0x7E ) ,      
EXTR2("(!)"        ,  -60.4121  ,  0x74 ) ,      
EXTR2("(!/"        ,  -64.9146  ,  0x72 ) ,      
EXTR2("(!~"        ,  -49.8949  ,  0x79 ) ,      
EXTR2("(/|"        ,  54.5282   ,  0xA9 ) ,      
EXTR2("(/|||"      ,  168.2132  ,  0xDD ) ,      
EXTR2("(X("        ,  212.6396  ,  0xF2 ) ,      
EXTR2("(X~"        ,  223.9920  ,  0xF7 ) ,      
EXTR2("(Y"         ,  -207.2880 ,  0x31 ) ,      
EXTR2("(Y("        ,  -212.6396 ,  0x2E ) ,      
EXTR2("(Y~"        ,  -223.9920 ,  0x29 ) ,      
EXTR2("(\\!"       ,  -54.5282  ,  0x77 ) ,      
EXTR2("(\\!!!"     ,  -168.2132 ,  0x43 ) ,      
EXTR2("(|"         ,  33.1480   ,  0x9F ) ,      
EXTR2("(|("        ,  38.9058   ,  0xA2 ) ,      
EXTR2("(|)"        ,  60.4121   ,  0xAC ) ,      
EXTR2("(|\\"       ,  64.9146   ,  0xAE ) ,      
EXTR2("(||"        ,  93.6030   ,  0xBB ) ,      
EXTR2("(||("       ,  98.9546   ,  0xBE ) ,      
EXTR2("(|||"       ,  146.8330  ,  0xD3 ) ,      
EXTR2("(|||("      ,  152.5908  ,  0xD6 ) ,      
EXTR2("(|||)"      ,  174.0971  ,  0xE0 ) ,      
EXTR2("(|||\\"     ,  178.5996  ,  0xE2 ) ,      
EXTR2("(|||~"      ,  163.5799  ,  0xDB ) ,      
EXTR2("(||~"       ,  110.3070  ,  0xC3 ) ,      
EXTR2("(|~"        ,  49.8949   ,  0xA7 ) ,      
EXTR2(")!"         ,  -3.3780   ,  0x8F ) ,      
EXTR2(")!!!"       ,  -117.0630 ,  0x5B ) ,      
EXTR2(")!!!("      ,  -123.3730 ,  0x58 ) ,      
EXTR2(")!!!)"      ,  -144.3271 ,  0x4F ) ,      
EXTR2(")!!!//"     ,  -180.9761 ,  0x3D ) ,      
EXTR2(")!!!~"      ,  -133.7670 ,  0x53 ) ,      
EXTR2(")!!("       ,  -70.6724  ,  0x70 ) ,      
EXTR2(")!!)"       ,  -88.8007  ,  0x67 ) ,      
EXTR2(")!!~"       ,  -80.5370  ,  0x6B ) ,      
EXTR2(")!("        ,  -9.6880   ,  0x8C ) ,      
EXTR2(")!)"        ,  -30.6421  ,  0x83 ) ,      
EXTR2(")!//"       ,  -67.2911  ,  0x71 ) ,      
EXTR2(")!~"        ,  -20.0820  ,  0x87 ) ,      
EXTR2(")/"         ,  196.7279  ,  0xEB ) ,      
EXTR2(")//"        ,  218.6404  ,  0xF5 ) ,      
EXTR2(")//|"       ,  46.3939   ,  0xA5 ) ,      
EXTR2(")//||"      ,  104.9554  ,  0xC1 ) ,      
EXTR2(")//|||"     ,  160.0790  ,  0xD9 ) ,      
EXTR2(")/|"        ,  24.8843   ,  0x9B ) ,      
EXTR2(")/|\\"      ,  56.4819   ,  0xAA ) ,      
EXTR2(")/||"       ,  83.0429   ,  0xB7 ) ,      
EXTR2(")/|||"      ,  138.5693  ,  0xCF ) ,      
EXTR2(")/|||\\"    ,  170.1669  ,  0xDE ) ,      
EXTR2(")X("        ,  184.3574  ,  0xE4 ) ,      
EXTR2(")X)"        ,  202.4857  ,  0xED ) ,      
EXTR2(")X~"        ,  194.2220  ,  0xE9 ) ,      
EXTR2(")Y("        ,  -184.3574 ,  0x3C ) ,      
EXTR2(")Y)"        ,  -202.4857 ,  0x33 ) ,      
EXTR2(")Y~"        ,  -194.2220 ,  0x37 ) ,      
EXTR2(")\\!"       ,  -24.8843  ,  0x85 ) ,      
EXTR2(")\\!!"      ,  -83.0429  ,  0x69 ) ,      
EXTR2(")\\!!!"     ,  -138.5693 ,  0x51 ) ,      
EXTR2(")\\!!!/"    ,  -170.1669 ,  0x42 ) ,      
EXTR2(")\\!/"      ,  -56.4819  ,  0x76 ) ,      
EXTR2(")\\Y"       ,  -196.7279 ,  0x35 ) ,      
EXTR2(")\\\\!"     ,  -46.3939  ,  0x7B ) ,      
EXTR2(")\\\\!!"    ,  -104.9554 ,  0x5F ) ,      
EXTR2(")\\\\!!!"   ,  -160.0790 ,  0x47 ) ,      
EXTR2(")\\\\Y"     ,  -218.6404 ,  0x2B ) ,      
EXTR2(")|"         ,  3.3780    ,  0x91 ) ,      
EXTR2(")|("        ,  9.6880    ,  0x94 ) ,      
EXTR2(")|)"        ,  30.6421   ,  0x9D ) ,      
EXTR2(")|\\\\"     ,  67.2911   ,  0xAF ) ,      
EXTR2(")||("       ,  70.6724   ,  0xB0 ) ,      
EXTR2(")||)"       ,  88.8007   ,  0xB9 ) ,      
EXTR2(")|||"       ,  117.0630  ,  0xC5 ) ,      
EXTR2(")|||("      ,  123.3730  ,  0xC8 ) ,      
EXTR2(")|||)"      ,  144.3271  ,  0xD1 ) ,      
EXTR2(")|||\\\\"   ,  180.9761  ,  0xE3 ) ,      
EXTR2(")|||~"      ,  133.7670  ,  0xCD ) ,      
EXTR2(")||~"       ,  80.5370   ,  0xB5 ) ,      
EXTR2(")|~"        ,  20.0820   ,  0x99 ) ,      
EXTR2(")~"         ,  187.0399  ,  0xE5 ) ,      
EXTR2(")~!"        ,  -12.0644  ,  0x8B ) ,      
EXTR2(")~!!"       ,  -73.3549  ,  0x6F ) ,      
EXTR2(")~!!!"      ,  -125.7494 ,  0x57 ) ,      
EXTR2(")~Y"        ,  -187.0399 ,  0x3B ) ,      
EXTR2(")~|"        ,  12.0644   ,  0x95 ) ,      
EXTR2(")~||"       ,  73.3549   ,  0xB1 ) ,      
EXTR2(")~|||"      ,  125.7494  ,  0xC9 ) ,      
EXTR2("*"          ,  -27.2641  ,  0x84 ) ,
EXTR2("+"          ,  21.5063   ,  0x9A ) ,
EXTR2("-"          ,  -21.5063  ,  0x86 ) ,
EXTR2("/"          ,  195.6034  ,  0xEA ) ,      
EXTR2("//"         ,  217.6821  ,  0xF4 ) ,      
EXTR2("//|"        ,  43.0126   ,  0xA4 ) ,      
EXTR2("//||"       ,  103.9970  ,  0xC0 ) ,      
EXTR2("//|||"      ,  156.6976  ,  0xD8 ) ,      
EXTR2("/X)"        ,  221.6122  ,  0xF6 ) ,      
EXTR2("/X\\"       ,  227.3700  ,  0xF8 ) ,      
EXTR2("/X~"        ,  210.8257  ,  0xF1 ) ,      
EXTR2("/|"         ,  21.5063   ,  0x9A ) ,      
EXTR2("/|)"        ,  48.7704   ,  0xA6 ) ,      
EXTR2("/|\\"       ,  53.2729   ,  0xA8 ) ,      
EXTR2("/||"        ,  81.9184   ,  0xB6 ) ,      
EXTR2("/||)"       ,  107.9272  ,  0xC2 ) ,      
EXTR2("/||\\"      ,  113.6850  ,  0xC4 ) ,      
EXTR2("/|||"       ,  135.1913  ,  0xCE ) ,      
EXTR2("/|||)"      ,  162.4554  ,  0xDA ) ,      
EXTR2("/|||\\"     ,  166.9579  ,  0xDC ) ,      
EXTR2("/|||~"      ,  151.7356  ,  0xD5 ) ,      
EXTR2("/||~"       ,  97.1407   ,  0xBD ) ,      
EXTR2("/|~"        ,  38.0506   ,  0xA1 ) ,      
EXTR2("<"          ,  -53.2729  ,  0x78 ) ,
EXTR2(">"          ,  53.2729   ,  0xA8 ) ,
EXTR2("@"          ,  27.2641   ,  0x9C ) ,
EXTR2("X)"         ,  200.1059  ,  0xEC ) ,      
EXTR2("X\\"        ,  205.8637  ,  0xEE ) ,      
EXTR2("X~"         ,  189.3194  ,  0xE7 ) ,      
EXTR2("Y)"         ,  -200.1059 ,  0x34 ) ,      
EXTR2("Y/"         ,  -205.8637 ,  0x32 ) ,      
EXTR2("Y~"         ,  -189.3194 ,  0x39 ) ,      
EXTR2("["          ,  -93.6030  ,  0x65 ) ,
EXTR2("\\!"        ,  -21.5063  ,  0x86 ) ,      
EXTR2("\\!!"       ,  -81.9184  ,  0x6A ) ,      
EXTR2("\\!!!"      ,  -135.1913 ,  0x52 ) ,      
EXTR2("\\!!!)"     ,  -162.4554 ,  0x46 ) ,      
EXTR2("\\!!!/"     ,  -166.9579 ,  0x44 ) ,      
EXTR2("\\!!!~"     ,  -151.7356 ,  0x4B ) ,      
EXTR2("\\!!)"      ,  -107.9272 ,  0x5E ) ,      
EXTR2("\\!!/"      ,  -113.6850 ,  0x5C ) ,      
EXTR2("\\!!~"      ,  -97.1407  ,  0x63 ) ,      
EXTR2("\\!)"       ,  -48.7704  ,  0x7A ) ,      
EXTR2("\\!/"       ,  -53.2729  ,  0x78 ) ,      
EXTR2("\\!~"       ,  -38.0506  ,  0x7F ) ,      
EXTR2("\\Y"        ,  -195.6034 ,  0x36 ) ,      
EXTR2("\\Y)"       ,  -221.6122 ,  0x2A ) ,      
EXTR2("\\Y/"       ,  -227.3700 ,  0x28 ) ,      
EXTR2("\\Y~"       ,  -210.8257 ,  0x2F ) ,      
EXTR2("\\\\!"      ,  -43.0126  ,  0x7C ) ,      
EXTR2("\\\\!!"     ,  -103.9970 ,  0x60 ) ,      
EXTR2("\\\\!!!"    ,  -156.6976 ,  0x48 ) ,      
EXTR2("\\\\Y"      ,  -217.6821 ,  0x2C ) ,      
EXTR2("]"          ,  93.6030   ,  0xBB ) ,
EXTR2("^"          ,  113.6850  ,  0xFD ) ,      
EXTR2("^^"         ,  227.3700  ,  0xFF ) ,      
EXTR2("_"          ,  -113.6850 ,  0x23 ) ,      
EXTR2("__"         ,  -227.3700 ,  0x21 ) ,      
EXTR2("m"          ,  65.3373   ,  0x12 ) ,
EXTR2("n"          ,  104.9554  ,  0xC1 ) ,
EXTR2("v"          ,  -104.9554 ,  0x5F ) ,
EXTR2("w"          ,  -65.3373  ,  0x10 ) ,
EXTR2("{"          ,  -73.6807  ,  0x11 ) ,
EXTR2("|"          ,  0.0       ,  0x32 ) ,      
EXTR2("|("         ,  5.7578    ,  0x92 ) ,      
EXTR2("|)"         ,  27.2641   ,  0x9C ) ,      
EXTR2("|//|"       ,  0.0000    ,  0x90 ) ,      
EXTR2("|\\"        ,  31.7667   ,  0x9E ) ,      
EXTR2("|\\)"       ,  59.1568   ,  0xAB ) ,      
EXTR2("|\\\\"      ,  63.7901   ,  0xAD ) ,      
EXTR2("||)"        ,  86.4209   ,  0xB8 ) ,      
EXTR2("||\\"       ,  92.1787   ,  0xBA ) ,      
EXTR2("|||("       ,  119.4428  ,  0xC6 ) ,      
EXTR2("|||)"       ,  140.9491  ,  0xD0 ) ,      
EXTR2("|||\\"      ,  145.4517  ,  0xD2 ) ,      
EXTR2("|||\\)"     ,  172.8418  ,  0xDF ) ,      
EXTR2("|||\\\\"    ,  177.4751  ,  0xE1 ) ,      
EXTR2("|||~"       ,  130.2293  ,  0xCB ) ,      
EXTR2("||~"        ,  75.6344   ,  0xB3 ) ,      
EXTR2("|~"         ,  16.5443   ,  0x97 ) ,      
EXTR2("}"          ,  73.6807   ,  0x13 ) ,
EXTR2("~!"         ,  -8.7296   ,  0x8D ) ,      
EXTR2("~!!!"       ,  -122.4146 ,  0x59 ) ,      
EXTR2("~!!!("      ,  -128.4154 ,  0x56 ) ,      
EXTR2("~!!!)"      ,  -149.3818 ,  0x4C ) ,      
EXTR2("~!!!/"      ,  -154.0151 ,  0x49 ) ,      
EXTR2("~!!("       ,  -74.7792  ,  0x6E ) ,      
EXTR2("~!!)"       ,  -96.1089  ,  0x64 ) ,      
EXTR2("~!!/"       ,  -101.6206 ,  0x61 ) ,      
EXTR2("~!("        ,  -14.7304  ,  0x8A ) ,      
EXTR2("~!)"        ,  -35.6968  ,  0x80 ) ,      
EXTR2("~!/"        ,  -40.3301  ,  0x7D ) ,      
EXTR2("~X("        ,  188.4642  ,  0xE6 ) ,      
EXTR2("~X)"        ,  209.7939  ,  0xF0 ) ,      
EXTR2("~X\\"       ,  215.3056  ,  0xF3 ) ,      
EXTR2("~Y("        ,  -188.4642 ,  0x3A ) ,      
EXTR2("~Y)"        ,  -209.7939 ,  0x30 ) ,      
EXTR2("~|"         ,  8.7296    ,  0x93 ) ,      
EXTR2("~|("        ,  14.7304   ,  0x96 ) ,      
EXTR2("~|)"        ,  35.6968   ,  0xA0 ) ,      
EXTR2("~|/"        ,  -215.3056 ,  0x2D ) ,      
EXTR2("~|\\"       ,  40.3301   ,  0xA3 ) ,      
EXTR2("~||("       ,  74.7792   ,  0xB2 ) ,      
EXTR2("~||)"       ,  96.1089   ,  0xBC ) ,      
EXTR2("~||\\"      ,  101.6206  ,  0xBF ) ,      
EXTR2("~|||"       ,  122.4146  ,  0xC7 ) ,      
EXTR2("~|||("      ,  128.4154  ,  0xCA ) ,      
EXTR2("~|||)"      ,  149.3818  ,  0xD4 ) ,      
EXTR2("~|||\\"     ,  154.0151  ,  0xD7 ) ,      
EXTR2("~~"         ,  191.6732  ,  0xE8 ) ,      
EXTR2("~~!"        ,  -17.5761  ,  0x88 ) ,      
EXTR2("~~!!"       ,  -77.9882  ,  0x6C ) ,      
EXTR2("~~!!!"      ,  -131.2611 ,  0x54 ) ,      
EXTR2("~~Y"        ,  -191.6732 ,  0x38 ) ,      
EXTR2("~~|"        ,  17.5761   ,  0x98 ) ,      
EXTR2("~~||"       ,  77.9882   ,  0xB4 ) ,      
EXTR2("~~|||"      ,  131.2611  ,  0xCC ) ,

};

unsigned char sagittalcode[] = {
EXTR3("!"          ,  0.0       ,  0x32 ) ,      
EXTR3("!!!("       ,  -119.4428 ,  0x5A ) ,      
EXTR3("!!!)"       ,  -140.9491 ,  0x50 ) ,      
EXTR3("!!!/"       ,  -145.4517 ,  0x4E ) ,      
EXTR3("!!!/)"      ,  -172.8418 ,  0x41 ) ,      
EXTR3("!!!//"      ,  -177.4751 ,  0x3F ) ,      
EXTR3("!!!~"       ,  -130.2293 ,  0x55 ) ,      
EXTR3("!!)"        ,  -86.4209  ,  0x68 ) ,      
EXTR3("!!/"        ,  -92.1787  ,  0x66 ) ,      
EXTR3("!!~"        ,  -75.6344  ,  0x6D ) ,      
EXTR3("!("         ,  -5.7578   ,  0x8E ) ,      
EXTR3("!)"         ,  -27.2641  ,  0x84 ) ,      
EXTR3("!/"         ,  -31.7667  ,  0x82 ) ,      
EXTR3("!/)"        ,  -59.1568  ,  0x75 ) ,      
EXTR3("!//"        ,  -63.7901  ,  0x73 ) ,      
EXTR3("!~"         ,  -16.5443  ,  0x89 ) ,      
EXTR3("("          ,  207.2880  ,  0xEF ) ,      
EXTR3("(!"         ,  -33.1480  ,  0x81 ) ,      
EXTR3("(!!"        ,  -93.6030  ,  0x65 ) ,      
EXTR3("(!!!"       ,  -146.8330 ,  0x4D ) ,      
EXTR3("(!!!("      ,  -152.5908 ,  0x4A ) ,      
EXTR3("(!!!)"      ,  -174.0971 ,  0x40 ) ,      
EXTR3("(!!!/"      ,  -178.5996 ,  0x3E ) ,      
EXTR3("(!!!~"      ,  -163.5799 ,  0x45 ) ,      
EXTR3("(!!("       ,  -98.9546  ,  0x62 ) ,      
EXTR3("(!!~"       ,  -110.3070 ,  0x5D ) ,      
EXTR3("(!("        ,  -38.9058  ,  0x7E ) ,      
EXTR3("(!)"        ,  -60.4121  ,  0x74 ) ,      
EXTR3("(!/"        ,  -64.9146  ,  0x72 ) ,      
EXTR3("(!~"        ,  -49.8949  ,  0x79 ) ,      
EXTR3("(/|"        ,  54.5282   ,  0xA9 ) ,      
EXTR3("(/|||"      ,  168.2132  ,  0xDD ) ,      
EXTR3("(X("        ,  212.6396  ,  0xF2 ) ,      
EXTR3("(X~"        ,  223.9920  ,  0xF7 ) ,      
EXTR3("(Y"         ,  -207.2880 ,  0x31 ) ,      
EXTR3("(Y("        ,  -212.6396 ,  0x2E ) ,      
EXTR3("(Y~"        ,  -223.9920 ,  0x29 ) ,      
EXTR3("(\\!"       ,  -54.5282  ,  0x77 ) ,      
EXTR3("(\\!!!"     ,  -168.2132 ,  0x43 ) ,      
EXTR3("(|"         ,  33.1480   ,  0x9F ) ,      
EXTR3("(|("        ,  38.9058   ,  0xA2 ) ,      
EXTR3("(|)"        ,  60.4121   ,  0xAC ) ,      
EXTR3("(|\\"       ,  64.9146   ,  0xAE ) ,      
EXTR3("(||"        ,  93.6030   ,  0xBB ) ,      
EXTR3("(||("       ,  98.9546   ,  0xBE ) ,      
EXTR3("(|||"       ,  146.8330  ,  0xD3 ) ,      
EXTR3("(|||("      ,  152.5908  ,  0xD6 ) ,      
EXTR3("(|||)"      ,  174.0971  ,  0xE0 ) ,      
EXTR3("(|||\\"     ,  178.5996  ,  0xE2 ) ,      
EXTR3("(|||~"      ,  163.5799  ,  0xDB ) ,      
EXTR3("(||~"       ,  110.3070  ,  0xC3 ) ,      
EXTR3("(|~"        ,  49.8949   ,  0xA7 ) ,      
EXTR3(")!"         ,  -3.3780   ,  0x8F ) ,      
EXTR3(")!!!"       ,  -117.0630 ,  0x5B ) ,      
EXTR3(")!!!("      ,  -123.3730 ,  0x58 ) ,      
EXTR3(")!!!)"      ,  -144.3271 ,  0x4F ) ,      
EXTR3(")!!!//"     ,  -180.9761 ,  0x3D ) ,      
EXTR3(")!!!~"      ,  -133.7670 ,  0x53 ) ,      
EXTR3(")!!("       ,  -70.6724  ,  0x70 ) ,      
EXTR3(")!!)"       ,  -88.8007  ,  0x67 ) ,      
EXTR3(")!!~"       ,  -80.5370  ,  0x6B ) ,      
EXTR3(")!("        ,  -9.6880   ,  0x8C ) ,      
EXTR3(")!)"        ,  -30.6421  ,  0x83 ) ,      
EXTR3(")!//"       ,  -67.2911  ,  0x71 ) ,      
EXTR3(")!~"        ,  -20.0820  ,  0x87 ) ,      
EXTR3(")/"         ,  196.7279  ,  0xEB ) ,      
EXTR3(")//"        ,  218.6404  ,  0xF5 ) ,      
EXTR3(")//|"       ,  46.3939   ,  0xA5 ) ,      
EXTR3(")//||"      ,  104.9554  ,  0xC1 ) ,      
EXTR3(")//|||"     ,  160.0790  ,  0xD9 ) ,      
EXTR3(")/|"        ,  24.8843   ,  0x9B ) ,      
EXTR3(")/|\\"      ,  56.4819   ,  0xAA ) ,      
EXTR3(")/||"       ,  83.0429   ,  0xB7 ) ,      
EXTR3(")/|||"      ,  138.5693  ,  0xCF ) ,      
EXTR3(")/|||\\"    ,  170.1669  ,  0xDE ) ,      
EXTR3(")X("        ,  184.3574  ,  0xE4 ) ,      
EXTR3(")X)"        ,  202.4857  ,  0xED ) ,      
EXTR3(")X~"        ,  194.2220  ,  0xE9 ) ,      
EXTR3(")Y("        ,  -184.3574 ,  0x3C ) ,      
EXTR3(")Y)"        ,  -202.4857 ,  0x33 ) ,      
EXTR3(")Y~"        ,  -194.2220 ,  0x37 ) ,      
EXTR3(")\\!"       ,  -24.8843  ,  0x85 ) ,      
EXTR3(")\\!!"      ,  -83.0429  ,  0x69 ) ,      
EXTR3(")\\!!!"     ,  -138.5693 ,  0x51 ) ,      
EXTR3(")\\!!!/"    ,  -170.1669 ,  0x42 ) ,      
EXTR3(")\\!/"      ,  -56.4819  ,  0x76 ) ,      
EXTR3(")\\Y"       ,  -196.7279 ,  0x35 ) ,      
EXTR3(")\\\\!"     ,  -46.3939  ,  0x7B ) ,      
EXTR3(")\\\\!!"    ,  -104.9554 ,  0x5F ) ,      
EXTR3(")\\\\!!!"   ,  -160.0790 ,  0x47 ) ,      
EXTR3(")\\\\Y"     ,  -218.6404 ,  0x2B ) ,      
EXTR3(")|"         ,  3.3780    ,  0x91 ) ,      
EXTR3(")|("        ,  9.6880    ,  0x94 ) ,      
EXTR3(")|)"        ,  30.6421   ,  0x9D ) ,      
EXTR3(")|\\\\"     ,  67.2911   ,  0xAF ) ,      
EXTR3(")||("       ,  70.6724   ,  0xB0 ) ,      
EXTR3(")||)"       ,  88.8007   ,  0xB9 ) ,      
EXTR3(")|||"       ,  117.0630  ,  0xC5 ) ,      
EXTR3(")|||("      ,  123.3730  ,  0xC8 ) ,      
EXTR3(")|||)"      ,  144.3271  ,  0xD1 ) ,      
EXTR3(")|||\\\\"   ,  180.9761  ,  0xE3 ) ,      
EXTR3(")|||~"      ,  133.7670  ,  0xCD ) ,      
EXTR3(")||~"       ,  80.5370   ,  0xB5 ) ,      
EXTR3(")|~"        ,  20.0820   ,  0x99 ) ,      
EXTR3(")~"         ,  187.0399  ,  0xE5 ) ,      
EXTR3(")~!"        ,  -12.0644  ,  0x8B ) ,      
EXTR3(")~!!"       ,  -73.3549  ,  0x6F ) ,      
EXTR3(")~!!!"      ,  -125.7494 ,  0x57 ) ,      
EXTR3(")~Y"        ,  -187.0399 ,  0x3B ) ,      
EXTR3(")~|"        ,  12.0644   ,  0x95 ) ,      
EXTR3(")~||"       ,  73.3549   ,  0xB1 ) ,      
EXTR3(")~|||"      ,  125.7494  ,  0xC9 ) ,      
EXTR3("*"          ,  -27.2641  ,  0x84 ) ,
EXTR3("+"          ,  21.5063   ,  0x9A ) ,
EXTR3("-"          ,  -21.5063  ,  0x86 ) ,
EXTR3("/"          ,  195.6034  ,  0xEA ) ,      
EXTR3("//"         ,  217.6821  ,  0xF4 ) ,      
EXTR3("//|"        ,  43.0126   ,  0xA4 ) ,      
EXTR3("//||"       ,  103.9970  ,  0xC0 ) ,      
EXTR3("//|||"      ,  156.6976  ,  0xD8 ) ,      
EXTR3("/X)"        ,  221.6122  ,  0xF6 ) ,      
EXTR3("/X\\"       ,  227.3700  ,  0xF8 ) ,      
EXTR3("/X~"        ,  210.8257  ,  0xF1 ) ,      
EXTR3("/|"         ,  21.5063   ,  0x9A ) ,      
EXTR3("/|)"        ,  48.7704   ,  0xA6 ) ,      
EXTR3("/|\\"       ,  53.2729   ,  0xA8 ) ,      
EXTR3("/||"        ,  81.9184   ,  0xB6 ) ,      
EXTR3("/||)"       ,  107.9272  ,  0xC2 ) ,      
EXTR3("/||\\"      ,  113.6850  ,  0xC4 ) ,      
EXTR3("/|||"       ,  135.1913  ,  0xCE ) ,      
EXTR3("/|||)"      ,  162.4554  ,  0xDA ) ,      
EXTR3("/|||\\"     ,  166.9579  ,  0xDC ) ,      
EXTR3("/|||~"      ,  151.7356  ,  0xD5 ) ,      
EXTR3("/||~"       ,  97.1407   ,  0xBD ) ,      
EXTR3("/|~"        ,  38.0506   ,  0xA1 ) ,      
EXTR3("<"          ,  -53.2729  ,  0x78 ) ,
EXTR3(">"          ,  53.2729   ,  0xA8 ) ,
EXTR3("@"          ,  27.2641   ,  0x9C ) ,
EXTR3("X)"         ,  200.1059  ,  0xEC ) ,      
EXTR3("X\\"        ,  205.8637  ,  0xEE ) ,      
EXTR3("X~"         ,  189.3194  ,  0xE7 ) ,      
EXTR3("Y)"         ,  -200.1059 ,  0x34 ) ,      
EXTR3("Y/"         ,  -205.8637 ,  0x32 ) ,      
EXTR3("Y~"         ,  -189.3194 ,  0x39 ) ,      
EXTR3("["          ,  -93.6030  ,  0x65 ) ,
EXTR3("\\!"        ,  -21.5063  ,  0x86 ) ,      
EXTR3("\\!!"       ,  -81.9184  ,  0x6A ) ,      
EXTR3("\\!!!"      ,  -135.1913 ,  0x52 ) ,      
EXTR3("\\!!!)"     ,  -162.4554 ,  0x46 ) ,      
EXTR3("\\!!!/"     ,  -166.9579 ,  0x44 ) ,      
EXTR3("\\!!!~"     ,  -151.7356 ,  0x4B ) ,      
EXTR3("\\!!)"      ,  -107.9272 ,  0x5E ) ,      
EXTR3("\\!!/"      ,  -113.6850 ,  0x5C ) ,      
EXTR3("\\!!~"      ,  -97.1407  ,  0x63 ) ,      
EXTR3("\\!)"       ,  -48.7704  ,  0x7A ) ,      
EXTR3("\\!/"       ,  -53.2729  ,  0x78 ) ,      
EXTR3("\\!~"       ,  -38.0506  ,  0x7F ) ,      
EXTR3("\\Y"        ,  -195.6034 ,  0x36 ) ,      
EXTR3("\\Y)"       ,  -221.6122 ,  0x2A ) ,      
EXTR3("\\Y/"       ,  -227.3700 ,  0x28 ) ,      
EXTR3("\\Y~"       ,  -210.8257 ,  0x2F ) ,      
EXTR3("\\\\!"      ,  -43.0126  ,  0x7C ) ,      
EXTR3("\\\\!!"     ,  -103.9970 ,  0x60 ) ,      
EXTR3("\\\\!!!"    ,  -156.6976 ,  0x48 ) ,      
EXTR3("\\\\Y"      ,  -217.6821 ,  0x2C ) ,      
EXTR3("]"          ,  93.6030   ,  0xBB ) ,
EXTR3("^"          ,  113.6850  ,  0xFD ) ,      
EXTR3("^^"         ,  227.3700  ,  0xFF ) ,      
EXTR3("_"          ,  -113.6850 ,  0x23 ) ,      
EXTR3("__"         ,  -227.3700 ,  0x21 ) ,      
EXTR3("m"          ,  65.3373   ,  0x12 ) ,
EXTR3("n"          ,  104.9554  ,  0xC1 ) ,
EXTR3("v"          ,  -104.9554 ,  0x5F ) ,
EXTR3("w"          ,  -65.3373  ,  0x10 ) ,
EXTR3("{"          ,  -73.6807  ,  0x11 ) ,
EXTR3("|"          ,  0.0       ,  0x32 ) ,      
EXTR3("|("         ,  5.7578    ,  0x92 ) ,      
EXTR3("|)"         ,  27.2641   ,  0x9C ) ,      
EXTR3("|//|"       ,  0.0000    ,  0x90 ) ,      
EXTR3("|\\"        ,  31.7667   ,  0x9E ) ,      
EXTR3("|\\)"       ,  59.1568   ,  0xAB ) ,      
EXTR3("|\\\\"      ,  63.7901   ,  0xAD ) ,      
EXTR3("||)"        ,  86.4209   ,  0xB8 ) ,      
EXTR3("||\\"       ,  92.1787   ,  0xBA ) ,      
EXTR3("|||("       ,  119.4428  ,  0xC6 ) ,      
EXTR3("|||)"       ,  140.9491  ,  0xD0 ) ,      
EXTR3("|||\\"      ,  145.4517  ,  0xD2 ) ,      
EXTR3("|||\\)"     ,  172.8418  ,  0xDF ) ,      
EXTR3("|||\\\\"    ,  177.4751  ,  0xE1 ) ,      
EXTR3("|||~"       ,  130.2293  ,  0xCB ) ,      
EXTR3("||~"        ,  75.6344   ,  0xB3 ) ,      
EXTR3("|~"         ,  16.5443   ,  0x97 ) ,      
EXTR3("}"          ,  73.6807   ,  0x13 ) ,
EXTR3("~!"         ,  -8.7296   ,  0x8D ) ,      
EXTR3("~!!!"       ,  -122.4146 ,  0x59 ) ,      
EXTR3("~!!!("      ,  -128.4154 ,  0x56 ) ,      
EXTR3("~!!!)"      ,  -149.3818 ,  0x4C ) ,      
EXTR3("~!!!/"      ,  -154.0151 ,  0x49 ) ,      
EXTR3("~!!("       ,  -74.7792  ,  0x6E ) ,      
EXTR3("~!!)"       ,  -96.1089  ,  0x64 ) ,      
EXTR3("~!!/"       ,  -101.6206 ,  0x61 ) ,      
EXTR3("~!("        ,  -14.7304  ,  0x8A ) ,      
EXTR3("~!)"        ,  -35.6968  ,  0x80 ) ,      
EXTR3("~!/"        ,  -40.3301  ,  0x7D ) ,      
EXTR3("~X("        ,  188.4642  ,  0xE6 ) ,      
EXTR3("~X)"        ,  209.7939  ,  0xF0 ) ,      
EXTR3("~X\\"       ,  215.3056  ,  0xF3 ) ,      
EXTR3("~Y("        ,  -188.4642 ,  0x3A ) ,      
EXTR3("~Y)"        ,  -209.7939 ,  0x30 ) ,      
EXTR3("~|"         ,  8.7296    ,  0x93 ) ,      
EXTR3("~|("        ,  14.7304   ,  0x96 ) ,      
EXTR3("~|)"        ,  35.6968   ,  0xA0 ) ,      
EXTR3("~|/"        ,  -215.3056 ,  0x2D ) ,      
EXTR3("~|\\"       ,  40.3301   ,  0xA3 ) ,      
EXTR3("~||("       ,  74.7792   ,  0xB2 ) ,      
EXTR3("~||)"       ,  96.1089   ,  0xBC ) ,      
EXTR3("~||\\"      ,  101.6206  ,  0xBF ) ,      
EXTR3("~|||"       ,  122.4146  ,  0xC7 ) ,      
EXTR3("~|||("      ,  128.4154  ,  0xCA ) ,      
EXTR3("~|||)"      ,  149.3818  ,  0xD4 ) ,      
EXTR3("~|||\\"     ,  154.0151  ,  0xD7 ) ,      
EXTR3("~~"         ,  191.6732  ,  0xE8 ) ,      
EXTR3("~~!"        ,  -17.5761  ,  0x88 ) ,      
EXTR3("~~!!"       ,  -77.9882  ,  0x6C ) ,      
EXTR3("~~!!!"      ,  -131.2611 ,  0x54 ) ,      
EXTR3("~~Y"        ,  -191.6732 ,  0x38 ) ,      
EXTR3("~~|"        ,  17.5761   ,  0x98 ) ,      
EXTR3("~~||"       ,  77.9882   ,  0xB4 ) ,      
EXTR3("~~|||"      ,  131.2611  ,  0xCC ) ,
};

char *abcNoteAccidentalStart(abcScanner *scn)
{
  if (abcToken(scn) != T_NOTE) return utlEmptyString;
  if (abcTokenStart(scn,5)==abcTokenStart(scn,0)) return utlEmptyString;
  return abcTokenStart(scn,0);
}

int abcNoteAccidentalLen(abcScanner *scn)
{
  if (abcToken(scn) != T_NOTE) return 0;
  return abcTokenStart(scn,5)-abcTokenStart(scn,0);
}

float abcNoteDuration(abcScanner *scn)
{
  if (abcToken(scn) != T_NOTE) return 1.0;
  return getfraction(scn,7);
}

float abcNoteCents(abcScanner *scn)
{
  float cents;
  cents = abcNoteBending(scn);
  if (cents == abcNatural)
      cents = 0.0; 
  return cents ; 
}

static int abc_sagittalnum(char *sag)
{
  int n,j,k;
  int cmp;
  
  n = 0;
  j = 0; k = (sizeof(sagittal) / sizeof(sagittal[0]))-1;
  while (j<=k) {
    n = (j+k)/2;
    cmp = strcmp(sag,sagittal[n]) ;
    if ( cmp == 0) break;
    if ( cmp < 0) k = n-1;
    else j = n+1;
  }
  if (j<=k) return n;
  return -1;
}


static float bend;
static unsigned char sagitchr;

int abcSagittalChar(abcScanner *scn)
{

}

static float abc_sagittalcents(char *sag,int len)
{
  float  bend = 0.0;
  char sagit[8];
  int n;
  
  if (len > 7) len = 7;
  switch (*sag) {
    case '\'': bend = 1.954 * 2;
    case '`' : bend -= 1.954;
               sag++;  len--;
               break;
  }
  if (len == 0) return bend;
  
  switch(sag[len-1]) {
    case '\'': if (len>1 && sag[len-2] == '\'') {
                 bend += 0.833 - 0.423; len--;
               }
               bend += 0.423; len--;
               break;  
     
    case '`':  if (len>1 && sag[len-2] == '\'') {
                 bend += -(0.833 - 0.423); len--;
               }
               bend += -0.423; len--;
               break;  
  }
  if (len == 0) return bend;
  
  strncpy(sagit,sag,len);
  sagit[len] = '\0';
  _dbgmsg("SAGIT: %s\n",sagit);
  n = abc_sagittalnum(sagit);
  if (n>=0) bend += sagittalbend[n];
  return bend;  
}

float abcNoteBending(abcScanner *scn)
{
  int len;
  
  if (abcToken(scn) != T_NOTE) return 0.0;
  
  if (abcTestFlag(scn, ABC_F_BENDCOMPUTED))  
    return bend;
    
  abcSetFlag(scn,ABC_F_BENDCOMPUTED);
  sagitchr = 0;
  
  len = abcTokenLen(scn,1) ;
  if (len > 1 && *abcTokenStart(scn,1) == '=') 
    bend = abc_sagittalcents(abcTokenStart(scn,1)+1,len-1);
  else 
    bend = abc_notebending(abcTokenStart(scn,1), abcTokenLen(scn,1),
                         abcTokenStart(scn,2), abcTokenLen(scn,2),
                         abcTokenStart(scn,3), abcTokenLen(scn,3),
                         abcTokenStart(scn,4), abcTokenLen(scn,4) );
                         
  return bend;
}

float abcNoteMicrotoneNum(abcScanner *scn)
{
  int k;
  float num = 1.0;
  
  if (abcToken(scn) != T_NOTE) return 0.0;
  if (abcTokenLen(scn,2) > 0) 
    num = atof(abcTokenStart(scn,2));
  k = abcTokenLen(scn,1);
  if (k>0 && abcTokenStart(scn,1)[k-1] == '_')
    num = -num;
  return num;
}

float abcNoteMicrotoneDen(abcScanner *scn)
{
  int k;
  float den = -1.0;
  
  if (abcToken(scn) != T_NOTE) return 1.0;
  
  if (abcTokenLen(scn,4) > 0) 
    den = atof(abcTokenStart(scn,4));
    
  k = abcTokenLen(scn,3);
  if (k > 0) {
    if (den <= 0.0) den = 2.0;
    den = den * ((float)(1 << (k-1)));
  }
    
  if (den <= 0.0) {
    if (abcTokenLen(scn,2) > 0) den = 100.0;
    else den = 1.0;
  }
  return den;
}


int abcNoteOctave(abcScanner *scn)
{
  int oct = 4;
  int k;
  char *p;
    
  if (abcToken(scn) != T_NOTE) return 0;
  
  if (islower(*abcTokenStart(scn,5))) 
    oct++; 
    
  p = abcTokenStart(scn,6);
  for (k=0; k< abcTokenLen(scn,6); k++,p++) {
    switch (*p) {
      case '\'' : oct++; break;
      case ','  : oct--; break;
    }
  } 
  if (oct <  -1) oct = -1;
  else if (oct > 9) oct = 9;
  return oct;
}

int abcNoteCourtesyAccidentals(abcScanner *scn) 
{
  if (abcToken(scn) != T_NOTE) return 0;
  if (*abcTokenStart(scn,0) != '(') return 0;
  return 1;
}

unsigned char *abcNotePitch(abcScanner *scn)
{
  static char pitch[8];
  int k = 0;
  float bend;
  
  if (abcToken(scn) == T_NOTE) {  
    pitch[k++] = toupper(*abcTokenStart(scn,5));
    bend = abcNoteBending(scn);
    if (bend == abcNatural)
      bend = 0.0;
    if (bend > 0.0) {
      while (bend >= 100.0) {
        pitch[k++] = '#';
        bend -= 100;
      }
    }  
    else if (bend < 0.0) {
      while (bend <= -100.0) {
        pitch[k++] = 'b';
        bend += 100;
      } 
    }
  }
  pitch[k] = '\0';
  return pitch; 
}

unsigned short abcNote2Midi(char pitch, int octave, int acc)
{
  int n;
  n = abcSemitones[abcNote2Num(pitch)] - 1 + acc;
  n += 12 * octave;
  while (n>127) n -= 12;
  while (n<0) n += 12;
  return n;
}

unsigned short abcNoteMidi(abcScanner *scn)
{
  if (abcToken(scn) != T_NOTE) return 0;
  return abcNote2Midi(*abcTokenStart(scn,5),
                       abcNoteOctave(scn)+1,
                 (int)(abcNoteCents(scn)/100.0));
 }

unsigned short abcNoteMidiPitchBend(abcScanner *scn)
{
  float bend;
  if (abcToken(scn) != T_NOTE) return 0;
  
  bend =  abcNoteCents(scn)/100;
  return (8192 + (int)(8192.0 * (bend - trunc(bend))));
}


unsigned short abcRestInvisible(abcScanner *scn)
{
  if (abcToken(scn) != T_REST) return 1;
  return (*abcTokenStart(scn,1) == 'x'); 
}

unsigned short abcRestMultimeasure(abcScanner *scn)
{
  if (abcToken(scn) != T_REST) return 0;
  return (*abcTokenStart(scn,1) == 'Z'); 
}

float abcRestDuration(abcScanner *scn)
{
  if (abcToken(scn) != T_REST) return 1;
  return getfraction(scn,2);
}

/*************/

char *abcBarStart(abcScanner *scn)
{
  if (abcToken(scn) != T_BAR) return utlEmptyString;
  if (abcTokenLen(scn,3) == 0) return utlEmptyString;
  return abcTokenStart(scn,3);
}

int abcBarLen(abcScanner *scn)
{
  if (abcToken(scn) != T_BAR) return 0;
  return abcTokenLen(scn,3);
}

int abcBarDotted(abcScanner *scn)
{ 
  if (abcToken(scn) != T_BAR) return 0;
  if (abcTokenLen(scn,2) > 0) return 1;
  if (abcTokenLen(scn,3) == 0 && abcTokenLen(scn,1) & 1) return 1;
  return 0;
}

int abcBarInvisible(abcScanner *scn)
{
  char *b;
  int l;
  
  if (abcToken(scn) != T_BAR) return 1;
  l = abcTokenLen(scn,3);
  b = abcTokenStart(scn,3);
  if (b[1] == '[') {
    if (l == 2 && b[1] == ']') return 1;
    if (l == 3 && b[1] == '|' && b[2] == ']') return 1;
  }
  else if (l == 1 && b[0] == ']') return 1;
  return 0;
}

int abcBarRepeatBefore(abcScanner *scn)
{
  if (abcToken(scn) != T_BAR) return 0;
  if (abcTokenLen(scn,2) > 0 || abcTokenLen(scn,3) > 0) 
    return abcTokenLen(scn,1);
  else 
    return abcTokenLen(scn,1) / 2;
}

int abcBarRepeatAfter(abcScanner *scn)
{
  if (abcToken(scn) != T_BAR) return 0;
  if (abcTokenLen(scn,2) > 0 || abcTokenLen(scn,3) > 0) 
    return abcTokenLen(scn,4);
  else 
    return abcTokenLen(scn,1) / 2;
}

int abcBarEnding(abcScanner *scn)
{
  if (abcToken(scn) != T_ENDING) return 0;
  return atoi(abcTokenStart(scn,2));
}

char *abcBarEndingStart(abcScanner *scn)
{
  if (abcToken(scn) != T_ENDING) return utlEmptyString;
  return abcTokenStart(scn,2);
}

int abcBarEndingLen(abcScanner *scn)
{
  if (abcToken(scn) != T_ENDING) return 0;
  return abcTokenLen(scn,2);
}

/*** Broken rythm */

int abcBroken(abcScanner *scn)
{
  if (abcToken(scn) != T_BROKENLEFT && abcToken(scn) != T_BROKENRIGHT)
     return 0;
  return abcTokenLen(scn,0);
}

/*** Chord */

float abcChordDuration(abcScanner *scn)
{
  if (abcToken(scn) != T_CHORDEND) return 1;
  return getfraction(scn,1);
}

/*** Overlay */

int abcOverlay(abcScanner *scn)
{
  if (abcToken(scn) != T_OVLRESET  && abcToken(scn) != T_OVLSTART   && abcToken(scn) != T_OVLEND)
     return 0;
  return abcTokenLen(scn,1);
}

/** slur and tie */

char abcSlurDirection(abcScanner *scn)
{
  if ((abcToken(scn) != T_SLURSTART && abcToken(scn) != T_SLUREND) ||
      abcTokenLen(scn,2) == 0) return '-';
  return *abcTokenStart(scn,2);
}

char abcTieDirection(abcScanner *scn)
{
  if (abcToken(scn) != T_TIE || abcTokenLen(scn,2) == 0) return '-';
  return *abcTokenStart(scn,2);
}

int abcSlurDotted(abcScanner *scn)
{
  if (abcToken(scn) != T_SLURSTART && abcToken(scn) != T_SLUREND) return 0;
  return (abcTokenLen(scn,1) > 0);
}

int abcTieDotted(abcScanner *scn)
{
  if (abcToken(scn) != T_TIE) return 0;
  return (abcTokenLen(scn,1) > 0);
}

/** TUPLET */

int abcTuplet(abcScanner *scn)
{
  if (abcToken(scn) != T_TUPLET) return 0;
  return atoi(abcTokenStart(scn,1));
}

int abcTupletTime(abcScanner *scn)
{
  if (abcToken(scn) != T_TUPLET || abcTokenLen(scn,2)==0) return 0;
  return atoi(abcTokenStart(scn,2));
}

int abcTupletNext(abcScanner *scn)
{
  if (abcToken(scn) != T_TUPLET || abcTokenLen(scn,3)==0) return 0;
  return atoi(abcTokenStart(scn,3));
}

